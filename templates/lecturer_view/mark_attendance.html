{% extends "lecturer_view/lecturer_dashboard.html" %}
{% block title %}Mark Attendance{% endblock %}

{% block content %}
<header class="topbar">Mark Attendance</header>

<div class="wrapper">

  <main class="main-content">
    <div class="main-container">

      <h2>Mark Attendance</h2>
      <form method="post" action="{{ url_for('user.mark_attendance') }}">
        {{ form.hidden_tag() }}

        <div class="mb-3">
          <label for="course_id" class="form-label">Select Course</label>
          {{ form.course_id(class="form-select", id="course_id") }}
        </div>

        <div class="mb-3">
          <label for="student_ids" class="form-label">Select Students</label>
          {{ form.student_ids(class="form-select", multiple=true, id="student_ids") }}
        </div>

        <div class="mb-3">
          <label for="status" class="form-label">Attendance Status</label>
          {{ form.status(class="form-select") }}
        </div>

        <button type="submit" class="btn btn-primary">{{ form.submit.label.text }}</button>
      </form>
      
      {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mt-3">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
      {% endwith %}

      {% for field in form %}
      {% for error in field.errors %}
        <div class="alert alert-danger">{{ error }}</div>
      {% endfor %}
    {% endfor %}


    </div>
  </main>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const studentSelect = document.getElementById("student_ids");

  fetch('/get-students/0')
    .then(response => response.json())
    .then(data => {
      studentSelect.innerHTML = "";
      data.students.forEach(function(student) {
        const option = document.createElement("option");
        option.value = student.id;
        option.text = student.name + " (" + student.student_number + ")";
        studentSelect.appendChild(option);
      });
    });
});

</script>
{% endblock %}
